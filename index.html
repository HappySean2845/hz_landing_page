<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <meta name="browsermode" content="application">
    <meta name="x5-page-mode" content="app">
    <meta name="msapplication-tap-highlight" content="no">
    <title>华住酒店</title>
    <link rel="stylesheet" href="css/clean.css">
    <link rel="stylesheet" href="css/main.css">
    <script type="text/javascript" src="bower_components/jquery2/jquery.min.js"></script>
    <script type="text/javascript" src="js/css3d.js"></script>
</head>
<body>
<div class="container" id="container">
    <div class="mainIndex"  style="display: none">
        <div class="logo"><img src="img/index_logo_03.png"></div>
        <div class="img"><img src="img/index_img_03.png"></div>
        <div class="introd"><img src="img/index_introd_03.png"></div>
    </div>
    <div class="mainBar" style="display: none" id="mainBar">
        <div class="barItem barItem-1"><img src="img/bar_item1_07.png" alt=""></div>
        <div class="barItem barItem-2"><img src="img/bar_item2_11.png" alt=""></div>
        <div class="barItem barItem-3"><img src="img/bar_item3_15.png" alt=""></div>
        <div class="barItem barItem-4"><img src="img/bar_item4_19.png" alt=""></div>
        <!--拖动图标-->
        <div class="touchIcon" id="touchIcon"></div>
        <div class="touchLine"></div>
    </div>
    <div id="arScene" class="arScene">
    </div>
    <div  class="ar_item_1" id="ar_item_1"></div>
    <div  class="ar_item_2" id="ar_item_2"></div>
    <div  class="ar_item_3" id="ar_item_3"></div>
</div>
<script type="text/javascript" src="js/main.js"></script>
<script>
  function size() {
    var _screenWidth = document.documentElement.clientWidth < 300 ? 300 : document.documentElement.clientWidth,
      _UIWidth = 750,
      _fontSize = _screenWidth / _UIWidth * 100;
      window.fontSize = parseFloat(_fontSize);
    document.documentElement.style.fontSize = _fontSize + 'px';
  }
  size();
  window.onresize = function () {
    size();
  }
  $(function () {
    var windowHeight = $(window).height();
    $("#container").css("height", windowHeight);
    setTimeout(function () {
      $(".mainIndex").addClass("animate");
      return drawNext();
    },300)
    function drawNext() {
      return setTimeout(function () {
        $(".mainIndex").fadeOut(800);
        $("#mainBar").fadeIn(800);
      },2000)
    }
    function preventString(e) {
      return e.preventDefault()&&e.stopPropagation();
    }
    var touchObj = new Object();
    var touchIcon = document.getElementById("touchIcon");
    //获取最大可滑动距离
    var maxCoundTouch = windowHeight - 0 - $(touchIcon)[0].clientHeight*1;
    //开始拖动
    touchIcon.addEventListener("touchstart",function (event) {
      maxCoundTouch = windowHeight - 0 - $(touchIcon)[0].clientHeight*1;
      touchObj.bgTransHeight = parseInt(window.fontSize*30.93)-windowHeight;
//      alert(touchObj.bgTransHeight)
      console.log("开始拖动",event.targetTouches[0].pageY,'px')
      touchObj.startY  = parseInt(event.targetTouches[0].pageY);
      preventString(event);
    })
    //持续拖动
    touchIcon.addEventListener("touchmove",function (event) {
      touchObj.touchY  = parseInt(event.targetTouches[0].pageY) - touchObj.startY;
//      console.log("拖动距离",touchObj.touchY);
      if(touchObj.touchY>=0&&touchObj.touchY<=maxCoundTouch){
        $(touchIcon).css("top",touchObj.touchY + 'px');
        $(".mainBar").css("background-position-y",-1*((touchObj.bgTransHeight/maxCoundTouch)*touchObj.touchY)+'px')
        // 1 2 3 4 出现顺序
        if(1*touchObj.touchY>=maxCoundTouch*0.2){
          $(".barItem").removeClass("active");
          $(".barItem-1").addClass("active");
        }
        if((1*touchObj.touchY)>=(maxCoundTouch*0.4)){
          $(".barItem").removeClass("active");
          $(".barItem-2").addClass("active");
        }
        if(1*touchObj.touchY>=maxCoundTouch*0.6){
          $(".barItem").removeClass("active");
          $(".barItem-3").addClass("active");
        }
        if(1*touchObj.touchY>=maxCoundTouch*0.8){
          $(".barItem").removeClass("active");
          $(".barItem-4").addClass("active");
        }
      }else{
        return false;
      }
      preventString(event);
    })
    //持续拖动
    touchIcon.addEventListener("touchend",function (event) {
      console.log("拖动结束");
      preventString(event);
    })
    var s = new C3D.Stage();
    s.size(window.innerWidth, window.innerHeight).material({
      color: "rgba(0,0,0,0)"
    }).update();
    document.getElementById("arScene").appendChild(s.el);
    //创建场景
    var scene = C3D.create({
      type: 'sprite', position: [0, 0, -s.fov], children: [
        {
          type: 'plane',
          el: document.getElementById('ar_item_1'),
          name: 'p1',
          size: [150],
          position: [100, -30, 0],
          rotation: [20, 0, 0],
        },
        {
          type: 'plane',
          el: document.getElementById('ar_item_2'),
          name: 'p2',
          size: [150],
          position: [-100, -150, 0],
          rotation: [20, 0, 0],
//          material: [{color: C3D.getRandomColor()}]
        },
        {
          type: 'plane',
          el: document.getElementById('ar_item_3'),
          name: 'p3',
          size: [150],
          position: [-100, 150, 0],
          rotation: [20, 0, 0],
//          material: [{color: C3D.getRandomColor()}]
        },
      ]
    });
    s.addChild(scene);
    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;
    function go() {
      scene.rotate(0, 1, 0).updateT();
      scene.p3.rotate(-1, 0, 0).updateT();
      requestAnimationFrame(go);
    }
    requestAnimationFrame(go);
  })
</script>
</body>
</html>